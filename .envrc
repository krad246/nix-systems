#!/usr/bin/env bash
# strict_env

shopt -s globstar

TMPDIR="$(readlink -f "$TMPDIR")"
export TMPDIR

watch_file ./configurations/**
watch_file ./modules/**

devShell=".#interactive"
if has lorri; then
  eval "$(lorri direnv --flake "$devShell")"
else
  if type nix_direnv_manual_reload >/dev/null; then
    nix_direnv_manual_reload
  fi
  use flake "$devShell" \
    --option experimental-features 'nix-command flakes' \
    --option accept-flake-config true \
    --option show-trace true \
    --option connect-timeout 120 \
    --option timeout 120 \
    --option max-silent-time 180 \
    --fallback
fi
